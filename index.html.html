<!DOCTYPE html>
<html lang="mn">
<head>
<meta charset="UTF-8">
<title>–ë–ê–†–ê–ê –ë“Æ–†–¢–ì–≠–õ–ò–ô–ù –°–ò–°–¢–ï–ú</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
/* ====== “Æ–Ω–¥—Å—ç–Ω –∑–∞–≥–≤–∞—Ä ====== */
body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: linear-gradient(135deg, #ebc41ac0, #18d6d6ab, #4605dfc2); min-height: 100vh; }
.container { width: 95%; max-width: 1200px; margin: 20px auto; padding: 10px; }
h1, h2 { text-align: center; color:#234; }
input, select, button { margin: 5px; padding: 10px; border-radius: 8px; border: 1px solid #d1d5db; text-align:center; transition:0.2s; }
button { background: #3b82f6; border: none; font-weight: 600; cursor: pointer; color: white; box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
button:hover { background: #2563eb; transform: translateY(-1px); box-shadow:0 8px 16px rgba(0,0,0,0.2); }
.section-card { background: rgba(255,255,255,0.95); padding:20px; margin-top:20px; border-radius:15px; box-shadow:0 4px 15px rgba(0,0,0,0.15); }
.flex-row { display:flex; justify-content:center; flex-wrap: wrap; gap:10px; align-items:center; margin-bottom:10px; }
#mainContent { display:none; }
#licenseBox { margin:100px auto; padding:30px; width:340px; text-align:center; background: rgba(255,255,255,0.98); border-radius:15px; box-shadow:0 8px 25px rgba(0,0,0,0.25); }
#masterResetBtn { position: fixed; top: 20px; right: 20px; background: #ef4444; color:white; padding:10px 14px; border-radius:10px; cursor:pointer; box-shadow:0 6px 14px rgba(0,0,0,0.25); z-index:1000; }
#masterResetBtn:hover { background:#dc2626; transform:translateY(-2px); }
@media(max-width:600px){ input, select, button { width:95%; } .flex-row { flex-direction: column; } }
.summary { margin-top:10px; font-weight:bold; text-align:center; background: rgba(255,255,255,0.85); padding:10px; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,0.2); }

/* ====== –•“Ø—Å–Ω—ç–≥—Ç–∏–π–Ω —à–∏–Ω—ç –∑–∞–≥–≤–∞—Ä ====== */
table { width: 100%; border-collapse: collapse; margin-top: 12px; background:#fff; border-radius:14px; overflow:hidden; box-shadow: 0 6px 16px rgba(0,0,0,0.08); }
thead { background: linear-gradient(90deg, #3b82f6, #06b6d4); color:#fff; text-transform: uppercase; letter-spacing: .4px; }
th, td { padding: 12px 14px; text-align:center; border-bottom: 1px solid #eef2f7; }
tbody tr:nth-child(even) { background:#f9fafb; }
tbody tr:hover { background:#e0f2fe; transform: scale(1.005); transition: .15s ease; }
.table-actions button { padding:6px 10px; border-radius:8px; font-size:13px; margin: 0 2px; }
.btn-edit { background:#10b981; }
.btn-edit:hover { background:#059669; }
.btn-del { background:#ef4444; }
.btn-del:hover { background:#dc2626; }

/* –ê–Ω–∏–º–µ–π—à–Ω */
.animateAdd { animation: popGreen 0.6s ease; }
@keyframes popGreen { 0% { background-color: #b7f2b7; transform: scale(1.03);} 50% { background-color: #d4edda; transform: scale(1.01);} 100% { background-color: #d4edda; transform: scale(1);} }
</style>
</head>
<body>
<div class="container">

<div id="masterResetBtn" onclick="masterReset()">Master Reset</div>

<!-- ====== –õ–ò–¶–ï–ù–ó –ù–≠–í–¢–†–≠–• ====== -->
<div id="licenseBox">
  <h2>üîë –°–∏—Å—Ç–µ–º–¥ –Ω—ç–≤—Ç—Ä—ç—Ö</h2>
  <div class="flex-row">
    <input type="password" id="licenseInput" placeholder="–õ–∏—Ü–µ–Ω–∑–∏–π–Ω –∫–æ–¥">
    <button type="button" onclick="toggleLicenseVisibility()">üëÅÔ∏è</button>
  </div>
  <button onclick="checkLicense()">–ù—ç–≤—Ç—Ä—ç—Ö</button>
</div>

<!-- ====== “Æ–ù–î–°–≠–ù –ê–ì–£–£–õ–ì–ê ====== -->
<div id="mainContent">

<h1>üõç –ë–ê–†–ê–ê –ë“Æ–†–¢–ì–≠–õ–ò–ô–ù –°–ò–°–¢–ï–ú</h1>

<!-- –ë–∞—Ä–∞–∞ —Ö–∞–π—Ö -->
<div class="section-card">
  <h2>üîç –ë–∞—Ä–∞–∞ —Ö–∞–π—Ö</h2>
  <div class="flex-row">
    <input type="text" id="searchItem" placeholder="–ë–∞—Ä–∞–∞–Ω—ã –Ω—ç—Ä—ç—ç—Ä —Ö–∞–π—Ö" onkeyup="searchInventory()">
    <input type="text" id="searchSize" placeholder="–ù—ç–º—ç–ª—Ç –º—ç–¥—ç—ç–ª–ª—ç—ç—Ä —à“Ø“Ø—Ö" onkeyup="searchInventory()">
    <input type="number" id="searchQty" placeholder="–¢–æ–æ —à–∏—Ä—Ö—ç–≥—ç—ç—Ä —à“Ø“Ø—Ö" onkeyup="searchInventory()">
  </div>
</div>

<!-- –ë–∞—Ä–∞–∞ –Ω—ç–º—ç—Ö -->
<div class="section-card">
  <h2>‚ûï –ë–∞—Ä–∞–∞ –Ω—ç–º—ç—Ö</h2>
  <div class="flex-row">
    <input type="text" id="itemName" placeholder="–ë–∞—Ä–∞–∞–Ω—ã –Ω—ç—Ä">
    <input type="text" id="itemSize" placeholder="–ù—ç–º—ç–ª—Ç –º—ç–¥—ç—ç–ª—ç–ª">
    <input type="number" id="itemQty" placeholder="–¢–æ–æ —à–∏—Ä—Ö—ç–≥">
    <input type="number" id="itemPrice" placeholder="1 —à–∏—Ä—Ö—ç–≥–∏–π–Ω “Ø–Ω—ç">
    <input type="password" id="adminPassword" placeholder="Admin –Ω—É—É—Ü “Ø–≥">
    <button onclick="addItem()">–ë“Ø—Ä—Ç–≥—ç—Ö</button>
  </div>
  <table id="inventoryTable">
    <thead>
      <tr>
        <th>–ë–∞—Ä–∞–∞–Ω—ã –Ω—ç—Ä</th>
        <th>–ù—ç–º—ç–ª—Ç –º—ç–¥—ç—ç–ª—ç–ª</th>
        <th>–¢–æ–æ —à–∏—Ä—Ö—ç–≥</th>
        <th>“Æ–Ω—ç</th>
        <th>–ù–∏–π—Ç “Ø–Ω—ç</th>
        <th colspan="2">“Æ–π–ª–¥—ç–ª</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<!-- –•—É–¥–∞–ª–¥–∞–∞ -->
<div class="section-card">
  <h2>üí∞ –•—É–¥–∞–ª–¥–∞–∞</h2>
  <div class="flex-row">
    <input type="text" id="sellSearch" placeholder="–ë–∞—Ä–∞–∞–Ω—ã –Ω—ç—Ä—ç—ç—Ä —Ö–∞–π—Ö" onkeyup="filterSellItems()">
    <select id="sellItem"></select>
    <input type="number" id="sellQty" placeholder="–ó–∞—Ä–∞—Ö —Ç–æ–æ —à–∏—Ä—Ö—ç–≥">
    <select id="sellType">
      <option value="–ë—ç–ª—ç–Ω">–ë—ç–ª—ç–Ω</option>
      <option value="–ü–û–°">–ü–û–°</option>
      <option value="–î–∞–Ω—Å">–î–∞–Ω—Å</option>
      <option value="StorePay">StorePay</option>
      <option value="Pocket">Pocket</option>
    </select>
    <button onclick="sellItem()">–ó–∞—Ä–∞—Ö</button>
  </div>

  <!-- ”®–Ω”©”©–¥—Ä–∏–π–Ω –±–æ—Ä–ª—É—É–ª–∞–ª—Ç -->
  <div class="section-card" style="margin-top:14px;">
    <h2>üì¶ ”®–Ω”©”©–¥—Ä–∏–π–Ω –±–æ—Ä–ª—É—É–ª–∞–ª—Ç</h2>
    <div class="summary" id="todaySummary">
      üì¶ ”®–Ω”©”©–¥”©—Ä –∑–∞—Ä—Å–∞–Ω –Ω–∏–π—Ç –±–∞—Ä–∞–∞: <span id="todayTotalQty">0</span> —à–∏—Ä—Ö—ç–≥ <br>
      üíµ ”®–Ω”©”©–¥—Ä–∏–π–Ω –Ω–∏–π—Ç –±–æ—Ä–ª—É—É–ª–∞–ª—Ç: <span id="todayTotalSales">0</span>‚ÇÆ <br>
      ‚úÖ “Æ–ª–¥—Å—ç–Ω –Ω–∏–π—Ç –±–∞—Ä–∞–∞: <span id="todayRemainingQty">0</span> —à–∏—Ä—Ö—ç–≥
    </div>
    <table id="salesTodayTable">
      <thead>
        <tr>
          <th>–ë–∞—Ä–∞–∞–Ω—ã –Ω—ç—Ä</th>
          <th>–ó–∞—Ä–∞—Ö “Ø–Ω—ç</th>
          <th>–¢–æ–æ —à–∏—Ä—Ö—ç–≥</th>
          <th>–ù–∏–π—Ç –¥“Ø–Ω</th>
          <th>–¢”©—Ä”©–ª</th>
          <th>–¶–∞–≥ (24—Ü)</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<!-- –û–≥–Ω–æ–æ–≥–æ–æ—Ä —à“Ø“Ø—Ö -->
<div class="section-card">
  <h2>üìÖ –û–≥–Ω–æ–æ–≥–æ–æ—Ä —à“Ø“Ø—Ö</h2>
  <div class="flex-row">
    <input type="date" id="filterDate">
    <button onclick="filterSales()">–®“Ø“Ø—Ö</button>
    <button onclick="clearFilter()">–ë“Ø–≥–¥–∏–π–≥ —Ö–∞—Ä—É—É–ª–∞—Ö</button>
  </div>
  <div class="summary">
    üì¶ –°–æ–Ω–≥–æ—Å–æ–Ω ”©–¥—Ä–∏–π–Ω –Ω–∏–π—Ç –±–∞—Ä–∞–∞: <span id="filterTotalQty">0</span> —à–∏—Ä—Ö—ç–≥ &nbsp;|&nbsp;
    üíµ –°–æ–Ω–≥–æ—Å–æ–Ω ”©–¥—Ä–∏–π–Ω –Ω–∏–π—Ç –±–æ—Ä–ª—É—É–ª–∞–ª—Ç: <span id="filterTotalSales">0</span>‚ÇÆ
  </div>
  <table id="salesTable">
    <thead>
      <tr>
        <th>–ë–∞—Ä–∞–∞–Ω—ã –Ω—ç—Ä</th>
        <th>–ó–∞—Ä–∞—Ö “Ø–Ω—ç</th>
        <th>–¢–æ–æ —à–∏—Ä—Ö—ç–≥</th>
        <th>–ù–∏–π—Ç –¥“Ø–Ω</th>
        <th>–¢”©—Ä”©–ª</th>
        <th>–û–≥–Ω–æ–æ + —Ü–∞–≥</th>
        <th>–£—Å—Ç–∞—Ö ”©–¥”©—Ä</th>
        <th>“Æ–ª–¥—Å—ç–Ω —Ö–æ–Ω–æ–≥</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<!-- –ù—É—É—Ü “Ø–≥ —Å–æ–ª–∏—Ö -->
<div class="section-card">
  <h2>üîë –ù—É—É—Ü “Ø–≥ —Å–æ–ª–∏—Ö</h2>
  <div class="flex-row">
    <input type="password" id="currentPassword" placeholder="–û–¥–æ–æ–≥–∏–π–Ω –Ω—É—É—Ü “Ø–≥">
    <input type="password" id="newPassword" placeholder="–®–∏–Ω—ç –Ω—É—É—Ü “Ø–≥">
    <button onclick="changePassword()">–°–æ–ª–∏—Ö</button>
  </div>
</div>

<!-- –ú—ç–¥—ç—ç–ª—ç–ª —ç–∫—Å–ø–æ—Ä—Ç/–∏–º–ø–æ—Ä—Ç -->
<div class="section-card">
  <h2>üíæ –ú—ç–¥—ç—ç–ª—ç–ª —ç–∫—Å–ø–æ—Ä—Ç/–∏–º–ø–æ—Ä—Ç</h2>
  <div class="flex-row">
    <button onclick="exportData()">üì§ –≠–∫—Å–ø–æ—Ä—Ç–ª–æ—Ö (JSON)</button>
    <input type="file" id="importFile" accept=".json">
    <button onclick="importData()">üì• –ò–º–ø–æ—Ä—Ç–ª–æ—Ö</button>
  </div>
</div>

</div><!-- /#mainContent -->
</div><!-- /.container -->

<script>
/* ====== DATA ====== */
let inventory = JSON.parse(localStorage.getItem("inventory")) || [];
let sales = JSON.parse(localStorage.getItem("sales")) || [];
if(!localStorage.getItem("adminPassword")) localStorage.setItem("adminPassword","1234");
if(!localStorage.getItem("masterPassword")) localStorage.setItem("masterPassword","MASTER0000");
const LICENSE_KEY = "Kalil@20010130";

/* ====== LICENSE ====== */
if(localStorage.getItem("licenseValid")==="true"){
  document.getElementById("licenseBox").style.display="none";
  document.getElementById("mainContent").style.display="block";
}
function checkLicense(){
  const code=document.getElementById("licenseInput").value.trim();
  if(code===LICENSE_KEY){
    localStorage.setItem("licenseValid","true");
    document.getElementById("licenseBox").style.display="none";
    document.getElementById("mainContent").style.display="block";
    alert("–ê–º–∂–∏–ª—Ç—Ç–∞–π –Ω—ç–≤—Ç—ç—Ä–ª—ç—ç!");
  } else alert("–õ–∏—Ü–µ–Ω–∑–∏–π–Ω –∫–æ–¥ –±—É—Ä—É—É!");
}
function toggleLicenseVisibility(){
  const input=document.getElementById("licenseInput");
  input.type=input.type==="password"?"text":"password";
}
function masterReset(){
  const masterCode = prompt("Master reset –∫–æ–¥ –æ—Ä—É—É–ª–Ω–∞ —É—É:");
  if(masterCode===localStorage.getItem("masterPassword")){
    const newPass = prompt("–®–∏–Ω—ç admin –Ω—É—É—Ü “Ø–≥ –æ—Ä—É—É–ª–Ω–∞ —É—É:");
    if(newPass){ localStorage.setItem("adminPassword", newPass); alert("–ù—É—É—Ü “Ø–≥ –∞–º–∂–∏–ª—Ç—Ç–∞–π —Å–æ–ª–∏–≥–¥–ª–æ–æ!"); }
  } else alert("Master –∫–æ–¥ –±—É—Ä—É—É!");
}
function saveData(){
  localStorage.setItem("inventory", JSON.stringify(inventory));
  localStorage.setItem("sales", JSON.stringify(sales));
}

/* ====== INVENTORY TABLE ====== */
function updateInventoryTable(){
  const tbody=document.querySelector("#inventoryTable tbody");
  tbody.innerHTML="";
  inventory.forEach((item,index)=>{
    tbody.innerHTML+=`<tr>
      <td>${item.name}</td>
      <td>${item.size}</td>
      <td>${item.qty}</td>
      <td>${item.price}</td>
      <td>${item.qty*item.price}</td>
      <td class="table-actions"><button class="btn-edit" onclick="editItem(${index})">–ó–∞—Å–∞—Ö</button></td>
      <td class="table-actions"><button class="btn-del" onclick="deleteItem(${index})">–£—Å—Ç–≥–∞—Ö</button></td>
    </tr>`;
  });
  // –•—É–¥–∞–ª–¥–∞–∞–Ω—ã select-–∏–π–≥ —à–∏–Ω—ç—á–ª—ç—Ö
  const select=document.getElementById("sellItem"); 
  select.innerHTML="";
  inventory.forEach((item,i)=>{ select.innerHTML+=`<option value="${i}">${item.name} (${item.size})</option>`; });
  filterSellItems(); // —Ö–∞–π–ª—Ç—ã–≥ —Ö–∞–¥–≥–∞–ª–∂, —Å–æ–Ω–≥–æ–ª—Ç—ã–≥ —à“Ø“Ø–Ω—ç
  saveData();
}

/* ====== TODAY SALES ====== */
function updateTodaySales(){
  const tbody=document.querySelector("#salesTodayTable tbody"); 
  tbody.innerHTML="";
  let totalQty=0,totalSales=0,totalRemaining=0;
  const todayStr = new Date().toLocaleDateString();
  inventory.forEach(i=> totalRemaining+=i.qty);
  sales.forEach(sale=>{
    const saleDateStr = new Date(sale.dateTime).toLocaleDateString();
    if(saleDateStr===todayStr){
      const t = new Date(sale.dateTime);
      const time24 = t.getHours().toString().padStart(2,'0')+":"+t.getMinutes().toString().padStart(2,'0');
      tbody.innerHTML+=`<tr>
        <td>${sale.name}</td>
        <td>${sale.price}</td>
        <td>${sale.qty}</td>
        <td>${sale.price*sale.qty}</td>
        <td>${sale.type}</td>
        <td>${time24}</td>
      </tr>`;
      totalQty+=sale.qty; 
      totalSales+=sale.price*sale.qty;
    }
  });
  const summary=document.getElementById("todaySummary");
  document.getElementById("todayTotalQty").textContent=totalQty;
  document.getElementById("todayTotalSales").textContent=totalSales;
  document.getElementById("todayRemainingQty").textContent=totalRemaining;
  summary.classList.remove("animateAdd"); void summary.offsetWidth; summary.classList.add("animateAdd");
}

/* ====== SALES TABLE ====== */
function updateSalesTable(){
  const tbody=document.querySelector("#salesTable tbody"); 
  tbody.innerHTML="";
  const now = new Date(); now.setHours(0,0,0,0);
  // 90 —Ö–æ–Ω–æ–≥–æ–æ—Å –∞—Ö–∏—Å–∞–Ω –±–æ—Ä–ª—É—É–ª–∞–ª—Ç—É—É–¥—ã–≥ —Ü—ç–≤—ç—Ä–ª—ç—Ö
  sales = sales.filter(sale=>{
    const saleDate = new Date(sale.dateTime);
    const expireDate = new Date(saleDate);
    expireDate.setDate(expireDate.getDate()+90);
    expireDate.setHours(0,0,0,0);
    return now <= expireDate;
  });
  sales.forEach(sale=>{
    const saleDate = new Date(sale.dateTime);
    const expireDate = new Date(saleDate);
    expireDate.setDate(expireDate.getDate()+90);
    expireDate.setHours(0,0,0,0);
    const remainingDays = Math.max(Math.floor((expireDate-now)/(1000*60*60*24)),0);
    tbody.innerHTML+=`<tr>
      <td>${sale.name}</td>
      <td>${sale.price}</td>
      <td>${sale.qty}</td>
      <td>${sale.price*sale.qty}</td>
      <td>${sale.type}</td>
      <td>${saleDate.toLocaleString('en-GB')}</td>
      <td>${expireDate.toISOString().split('T')[0]}</td>
      <td>${remainingDays}</td>
    </tr>`;
  });
  updateTodaySales();
  saveData();
}

/* ====== CRUD ====== */
function addItem(){
  const name=document.getElementById("itemName").value.trim();
  const size=document.getElementById("itemSize").value.trim();
  const qty=parseInt(document.getElementById("itemQty").value);
  const price=parseInt(document.getElementById("itemPrice").value);
  const password=document.getElementById("adminPassword").value;
  if(password!==localStorage.getItem("adminPassword")){alert("–ù—É—É—Ü “Ø–≥ –±—É—Ä—É—É!"); return;}
  if(!name || !size || isNaN(qty) || qty<=0 || isNaN(price) || price<=0){alert("–ó”©–≤ –º—ç–¥—ç—ç–ª—ç–ª –æ—Ä—É—É–ª–Ω–∞ —É—É!"); return;}
  const exist=inventory.find(i=>i.name.toLowerCase()===name.toLowerCase() && i.size===size);
  if(exist){ exist.qty+=qty; exist.price=price; } else { inventory.push({name,size,qty,price}); }
  document.getElementById("itemName").value="";
  document.getElementById("itemSize").value="";
  document.getElementById("itemQty").value="";
  document.getElementById("itemPrice").value="";
  document.getElementById("adminPassword").value="";
  updateInventoryTable();
}
function editItem(index){
  const password=prompt("–ù—É—É—Ü “Ø–≥—ç—ç –æ—Ä—É—É–ª–Ω–∞ —É—É:");
  if(password!==localStorage.getItem("adminPassword")){ alert("–ù—É—É—Ü “Ø–≥ –±—É—Ä—É—É!"); return; }
  const newName=prompt("–®–∏–Ω—ç –Ω—ç—Ä:", inventory[index].name);
  const newSize=prompt("–®–∏–Ω—ç —Ö—ç–º–∂—ç—ç:", inventory[index].size);
  const newQty=parseInt(prompt("–®–∏–Ω—ç —Ç–æ–æ:", inventory[index].qty));
  const newPrice=parseInt(prompt("–®–∏–Ω—ç “Ø–Ω—ç:", inventory[index].price));
  if(newName && newSize && !isNaN(newQty) && newQty>=0 && !isNaN(newPrice) && newPrice>=0){
    inventory[index]={name:newName,size:newSize,qty:newQty,price:newPrice}; 
    updateInventoryTable(); 
  }
}
function deleteItem(index){
  const password=prompt("–ù—É—É—Ü “Ø–≥—ç—ç –æ—Ä—É—É–ª–Ω–∞ —É—É:");
  if(password!==localStorage.getItem("adminPassword")){ alert("–ù—É—É—Ü “Ø–≥ –±—É—Ä—É—É!"); return; }
  if(confirm("–¢–∞ —ç–Ω—ç –±–∞—Ä–∞–∞–≥ —É—Å—Ç–≥–∞—Ö–¥–∞–∞ –∏—Ç–≥—ç–ª—Ç—ç–π –±–∞–π–Ω–∞ —É—É?")){ inventory.splice(index,1); updateInventoryTable(); }
}

/* ====== SELL ====== */
function sellItem(){
  const index=parseInt(document.getElementById("sellItem").value);
  const qty=parseInt(document.getElementById("sellQty").value);
  const type=document.getElementById("sellType").value;
  if(isNaN(index)||isNaN(qty)||qty<=0){ alert("–ó”©–≤ —Ç–æ–æ –æ—Ä—É—É–ª–Ω–∞ —É—É!"); return;}
  if(!inventory[index] || inventory[index].qty<qty){ alert("–•–∞–Ω–≥–∞–ª—Ç—Ç–∞–π –±–∞—Ä–∞–∞ –±–∞–π—Ö–≥“Ø–π!"); return; }
  inventory[index].qty-=qty;
  sales.push({name:inventory[index].name, price:inventory[index].price, qty, type, dateTime:new Date().toISOString()});
  document.getElementById("sellQty").value="";
  updateInventoryTable();
  updateSalesTable();
  document.getElementById("todaySummary").classList.add("animateAdd");
  setTimeout(()=>document.getElementById("todaySummary").classList.remove("animateAdd"),600);
}

/* ====== SEARCH & FILTER ====== */
function searchInventory(){
  const name=document.getElementById("searchItem").value.toLowerCase();
  const size=document.getElementById("searchSize").value.toLowerCase();
  const qtyStr=document.getElementById("searchQty").value;
  const qty = qtyStr==="" ? null : parseInt(qtyStr);
  const tbody=document.querySelector("#inventoryTable tbody"); 
  tbody.innerHTML="";
  // –≠–Ω–¥ –±“Ø—Ä—ç–Ω –∏–Ω–¥–µ–∫—Å–∏–π–≥ –∞—à–∏–≥–ª–∞–∂, –∑–∞—Å–∞—Ö/—É—Å—Ç–≥–∞—Ö –∏–Ω–¥–µ–∫—Å –∑”©—Ä”©—Ö”©”©—Å —Å—ç—Ä–≥–∏–π–ª–Ω—ç
  inventory.forEach((item,i)=>{
    const ok = item.name.toLowerCase().includes(name) &&
               (size==="" || item.size.toLowerCase().includes(size)) &&
               (qty===null || item.qty===qty);
    if(ok){
      tbody.innerHTML+=`<tr>
        <td>${item.name}</td>
        <td>${item.size}</td>
        <td>${item.qty}</td>
        <td>${item.price}</td>
        <td>${item.qty*item.price}</td>
        <td class="table-actions"><button class="btn-edit" onclick="editItem(${i})">–ó–∞—Å–∞—Ö</button></td>
        <td class="table-actions"><button class="btn-del" onclick="deleteItem(${i})">–£—Å—Ç–≥–∞—Ö</button></td>
      </tr>`;
    }
  });
}
function filterSales(){
  const filterDate=document.getElementById("filterDate").value;
  if(!filterDate){ alert("–û–≥–Ω–æ–æ —Å–æ–Ω–≥–æ–Ω–æ —É—É!"); return; }
  const tbody=document.querySelector("#salesTable tbody"); 
  tbody.innerHTML="";
  let totalQty=0,totalSales=0;
  sales.forEach(sale=>{
    const saleDate = new Date(sale.dateTime);
    const saleStr = saleDate.toISOString().split("T")[0];
    if(saleStr===filterDate){
      const expireDate = new Date(saleDate); 
      expireDate.setDate(expireDate.getDate()+90); 
      expireDate.setHours(0,0,0,0);
      const now = new Date(); now.setHours(0,0,0,0);
      const remainingDays = Math.max(Math.floor((expireDate-now)/(1000*60*60*24)),0);
      tbody.innerHTML+=`<tr>
        <td>${sale.name}</td>
        <td>${sale.price}</td>
        <td>${sale.qty}</td>
        <td>${sale.price*sale.qty}</td>
        <td>${sale.type}</td>
        <td>${saleDate.toLocaleString('en-GB')}</td>
        <td>${expireDate.toISOString().split('T')[0]}</td>
        <td>${remainingDays}</td>
      </tr>`;
      totalQty+=sale.qty; totalSales+=sale.price*sale.qty;
    }
  });
  document.getElementById("filterTotalQty").textContent=totalQty;
  document.getElementById("filterTotalSales").textContent=totalSales;
}
function clearFilter(){ 
  document.getElementById("filterDate").value=""; 
  updateSalesTable(); 
  document.getElementById("filterTotalQty").textContent="0"; 
  document.getElementById("filterTotalSales").textContent="0"; 
}
function filterSellItems(){
  const query=document.getElementById("sellSearch").value.toLowerCase();
  const select=document.getElementById("sellItem");
  select.innerHTML="";
  inventory.forEach((item,i)=>{
    if(item.name.toLowerCase().includes(query)){
      select.innerHTML+=`<option value="${i}">${item.name} (${item.size})</option>`;
    }
  });
}

/* ====== PASSWORD ====== */
function changePassword(){
  const current=document.getElementById("currentPassword").value;
  const newP=document.getElementById("newPassword").value;
  if(current!==localStorage.getItem("adminPassword")){ alert("–ù—É—É—Ü “Ø–≥ –±—É—Ä—É—É!"); return; }
  if(!newP){ alert("–®–∏–Ω—ç –Ω—É—É—Ü “Ø–≥ –æ—Ä—É—É–ª–Ω–∞ —É—É!"); return; }
  localStorage.setItem("adminPassword", newP);
  alert("–ù—É—É—Ü “Ø–≥ –∞–º–∂–∏–ª—Ç—Ç–∞–π —Å–æ–ª–∏–≥–¥–ª–æ–æ!");
  document.getElementById("currentPassword").value=""; 
  document.getElementById("newPassword").value="";
}

/* ====== EXPORT/IMPORT ====== */
function exportData(){ 
  const data={inventory,sales,adminPassword:localStorage.getItem("adminPassword")};
  const blob=new Blob([JSON.stringify(data)],{type:"application/json"});
  const url=URL.createObjectURL(blob);
  const a=document.createElement("a"); a.href=url; a.download="inventory.json"; a.click();
  URL.revokeObjectURL(url);
}
function importData(){
  const file=document.getElementById("importFile").files[0];
  if(!file){ alert("–§–∞–π–ª —Å–æ–Ω–≥–æ–Ω–æ —É—É!"); return; }
  const reader=new FileReader();
  reader.onload=function(e){
    try{
      const data=JSON.parse(e.target.result);
      if(data.inventory && data.sales){ 
        inventory=data.inventory; 
        sales=data.sales; 
        if(data.adminPassword) localStorage.setItem("adminPassword", data.adminPassword); 
        updateInventoryTable(); 
        updateSalesTable(); 
        alert("–ò–º–ø–æ—Ä—Ç –∞–º–∂–∏–ª—Ç—Ç–∞–π!"); 
      } else alert("–§–∞–π–ª –±—É—Ä—É—É —Ñ–æ—Ä–º–∞—Ç—Ç–∞–π –±–∞–π–Ω–∞!");
    }catch(err){ alert("–§–∞–π–ª —É–Ω—à–∏–∂ —á–∞–¥—Å–∞–Ω–≥“Ø–π!"); }
  };
  reader.readAsText(file);
}

/* ====== INIT ====== */
updateInventoryTable();
updateSalesTable();
</script>

</body>
</html>
